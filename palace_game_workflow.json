{
  "name": "PalaceGame",
  "nodes": [
    {
      "parameters": {
        "formTitle": "ÂÆ´ÊñóÊ∏∏Êàè - ÈÄâÊã©‰Ω†ÁöÑÂëΩËøê",
        "formDescription": "Ê¨¢ËøéÊù•Âà∞ÂÆ´Âª∑‰∏ñÁïåÔºå‰Ω†ÁöÑÊØè‰∏Ä‰∏™ÈÄâÊã©ÈÉΩÂ∞ÜÂÜ≥ÂÆö‰Ω†ÁöÑÂëΩËøê„ÄÇ‰Ω†ÁöÑÊÄßÂà´ÂíåÂá∫Ë∫´ËÉåÊôØÂ∞ÜÂΩ±Âìç‰Ω†ÁöÑÊïÖ‰∫ãËµ∞Âêë„ÄÇ",
        "formFields": {
          "values": [
            {
              "fieldLabel": "Áé©ÂÆ∂ÊòµÁß∞",
              "requiredField": true
            },
            {
              "fieldLabel": "ËßíËâ≤ÊÄßÂà´",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  {
                    "option": "Áî∑"
                  },
                  {
                    "option": "Â•≥"
                  }
                ]
              },
              "requiredField": true
            },
            {
              "fieldLabel": "Âá∫Ë∫´ËÉåÊôØ",
              "fieldType": "dropdown",
              "fieldOptions": {
                "values": [
                  {
                    "option": "Â∏ùÁéã‰πãÂÆ∂"
                  },
                  {
                    "option": "‰π¶È¶ô‰∏ñÂÆ∂"
                  },
                  {
                    "option": "ÂÆòÂëò‰πãÂÆ∂"
                  },
                  {
                    "option": "ÂØíÈó®"
                  }
                ]
              },
              "requiredField": true
            }
          ]
        },
        "options": {
          "appendAttribution": false,
          "buttonLabel": "ÂºÄÂßãÊ∏∏Êàè"
        }
      },
      "id": "ebf5711d-31d8-4367-8bcd-827891b078b3",
      "name": "Game Start",
      "type": "n8n-nodes-base.formTrigger",
      "typeVersion": 2.3,
      "position": [
        -656,
        -32
      ],
      "webhookId": "e2808524-816e-4593-b10b-2e5df186b9ec"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "sessionId",
              "value": "={{ $now.toUnixInteger() }}-{{ $json['Áé©ÂÆ∂ÊòµÁß∞'] }}",
              "type": "string"
            },
            {
              "id": "id-2",
              "name": "playerName",
              "value": "={{ $json['Áé©ÂÆ∂ÊòµÁß∞'] }}",
              "type": "string"
            },
            {
              "id": "id-3",
              "name": "choiceHistory",
              "value": "[]",
              "type": "string"
            },
            {
              "id": "id-4",
              "name": "storyProgress",
              "value": 0,
              "type": "number"
            },
            {
              "id": "id-5",
              "name": "gameEnded",
              "value": false,
              "type": "boolean"
            },
            {
              "id": "id-6",
              "name": "currentAge",
              "value": "Â©¥ÂÑø",
              "type": "string"
            },
            {
              "id": "id-7",
              "name": "timePeriod",
              "value": "Âá∫Áîü",
              "type": "string"
            },
            {
              "id": "id-8",
              "name": "gender",
              "value": "={{ $json['ËßíËâ≤ÊÄßÂà´'] }}",
              "type": "string"
            },
            {
              "id": "id-9",
              "name": "background",
              "value": "={{ $json['Âá∫Ë∫´ËÉåÊôØ'] }}",
              "type": "string"
            },
            {
              "id": "id-10",
              "name": "npcPersonalities",
              "value": "{}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "32b152d3-c181-4284-94a8-c2c851248cf6",
      "name": "Initialize Game State",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -432,
        -32
      ]
    },
    {
      "parameters": {
        "dataTableId": {
          "__rl": true,
          "value": "AKf25SheQQH4ASxQ",
          "mode": "list",
          "cachedResultName": "palace_game_sessions",
          "cachedResultUrl": "/projects/znm1hvFsbhET4byn/datatables/AKf25SheQQH4ASxQ"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "sessionId": "={{ $json.sessionId }}",
            "playerName": "={{ $json.playerName }}",
            "choiceHistory": "={{ $json.choiceHistory }}",
            "storyProgress": "={{ $json.storyProgress }}",
            "gameEnded": "={{ $json.gameEnded }}",
            "currentAge": "={{ $json.currentAge }}",
            "timePeriod": "={{ $json.timePeriod }}",
            "gender": "={{ $json.gender }}",
            "background": "={{ $json.background }}",
            "npcPersonalities": "={{ $json.npcPersonalities }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "sessionId",
              "displayName": "sessionId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "playerName",
              "displayName": "playerName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "choiceHistory",
              "displayName": "choiceHistory",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "storyProgress",
              "displayName": "storyProgress",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "gameEnded",
              "displayName": "gameEnded",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "currentAge",
              "displayName": "currentAge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "timePeriod",
              "displayName": "timePeriod",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "gender",
              "displayName": "gender",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "background",
              "displayName": "background",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "npcPersonalities",
              "displayName": "npcPersonalities",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "29b8ea20-c31f-4dcd-a1a6-83749f98ca90",
      "name": "Save Game State",
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        -208,
        -32
      ]
    },
    {
      "parameters": {
        "operation": "get",
        "dataTableId": {
          "__rl": true,
          "value": "AKf25SheQQH4ASxQ",
          "mode": "list",
          "cachedResultName": "palace_game_sessions",
          "cachedResultUrl": "/projects/znm1hvFsbhET4byn/datatables/AKf25SheQQH4ASxQ"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "sessionId",
              "keyValue": "={{ $json.sessionId }}"
            }
          ]
        },
        "limit": 1
      },
      "id": "38acce85-37b4-464d-bc28-cc9c57fc16a6",
      "name": "Load Game State",
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        16,
        -32
      ]
    },
    {
      "parameters": {
        "jsCode": "// Prepare story context for DeepSeek API\nconst gameState = $input.first().json;\n\n// Parse choiceHistory if it's a string\nlet choiceHistory = gameState.choiceHistory || [];\nif (typeof choiceHistory === 'string') {\n  try {\n    choiceHistory = JSON.parse(choiceHistory);\n  } catch (error) {\n    choiceHistory = [];\n  }\n}\n\n// Parse npcPersonalities if it's a string\nlet npcPersonalities = gameState.npcPersonalities || [];\nif (typeof npcPersonalities === 'string') {\n  try {\n    npcPersonalities = JSON.parse(npcPersonalities);\n  } catch (error) {\n    npcPersonalities = [];\n  }\n}\n\n// Pass through all game state fields from input\nconst context = {\n  sessionId: gameState.sessionId,\n  playerName: gameState.playerName,\n  gender: gameState.gender,\n  background: gameState.background,\n  choiceHistory: choiceHistory,\n  npcPersonalities: npcPersonalities,\n  storyProgress: gameState.storyProgress || 0,\n  currentAge: gameState.currentAge || 'Â©¥ÂÑø',\n  timePeriod: gameState.timePeriod || 'Âá∫Áîü',\n  gameEnded: gameState.gameEnded || false\n};\n\nreturn [{ json: context }];"
      },
      "id": "c2301a8e-862a-4438-b061-e2eb8cb76f0b",
      "name": "Prepare Story Context",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        272,
        -112
      ]
    },
    {
      "parameters": {
        "jsCode": "// Build a detailed prompt for DeepSeek API to generate palace intrigue story\nconst gameState = $input.first().json;\n\n// Extract game state information\nconst playerName = gameState.playerName || 'Áé©ÂÆ∂';\nconst gender = gameState.gender || 'Â•≥';\nconst background = gameState.background || 'Â∏ùÁéã‰πãÂÆ∂';\nconst choiceHistory = gameState.choiceHistory || [];\nconst storyProgress = gameState.storyProgress || 0;\nconst currentAge = gameState.currentAge || 'Â©¥ÂÑø';\nconst timePeriod = gameState.timePeriod || 'Âá∫Áîü';\nconst sessionId = gameState.sessionId;\nconst gameEnded = gameState.gameEnded || false;\n\n// Parse npcPersonalities if it's a string\nlet npcPersonalities = gameState.npcPersonalities || {};\nif (typeof npcPersonalities === 'string') {\n  try {\n    npcPersonalities = JSON.parse(npcPersonalities);\n  } catch (error) {\n    npcPersonalities = {};\n  }\n}\n\n// Build context from previous choices\nlet previousChoicesContext = '';\nif (choiceHistory.length > 0) {\n  previousChoicesContext = '\\n\\n‰πãÂâçÁöÑÊïÖ‰∫ãÂèëÂ±ïÔºö\\n' + choiceHistory.map((choice, index) => {\n    return `Á¨¨${index + 1}ÂõûÂêàÔºö\\nÊÉÖÂ¢ÉÔºö${choice.situation}\\nÈÄâÊã©Ôºö${choice.chosen}\\nÊó∂Èó¥Ôºö${choice.timestamp}`;\n  }).join('\\n\\n');\n} else {\n  previousChoicesContext = '\\n\\nËøôÊòØÊïÖ‰∫ãÁöÑÂºÄÂßã„ÄÇ';\n}\n\n// Female-specific story paths\nconst genderPaths = `\nÂ•≥ÊÄßËßíËâ≤ÁâπÂÆöÊïÖ‰∫ãË∑ØÁ∫øÔºö\n- ÊØíÊùÄÁöáÂ∏ùÊàê‰∏∫Â•≥Â∏ùÔºöÈÄöËøáÊûÅÁ´ØÊâãÊÆµÂ§∫ÂèñÊúÄÈ´òÊùÉÂäõ\n- ÂÆ´ÊñóÂêéÂùê‰∏äÁöáÂêé‰πã‰ΩçÔºöÈÄöËøáÂÆ´Âª∑Êñó‰∫âÊàê‰∏∫ÁöáÂêé\n- ‰∏é‰∫≤ÁéãÁßÅÂ•îÔºö‰∏∫Áà±ÊÉÖÊîæÂºÉ‰∏ÄÂàáÔºåÈÄÉÁ¶ªÂÆ´Âª∑\n- Êàê‰∏∫ÊùÉÂÄæÊúùÈáéÁöÑÂ§™ÂêéÔºöÈÄöËøáÂÑøÂ≠êÊéåÊéßÊúùÊîø\n- ËÅîÂßªÂíå‰∫≤ÔºöÊàê‰∏∫ÊîøÊ≤ªËÅîÂßªÁöÑÂ∑•ÂÖ∑ÔºåÂú®ÂºÇÂõΩ‰ªñ‰π°Ë∞ãÊ±ÇÁîüÂ≠ò\n- Âá∫ÂÆ∂‰∏∫Â∞ºÔºöÈÄÉÁ¶ªÂÆ´Âª∑Á∫∑‰∫âÔºåÂØªÊ±ÇÂøÉÁÅµÂπ≥Èùô`;\n\n// Build background-specific story elements\nconst backgroundElements = {\n  'Â∏ùÁéã‰πãÂÆ∂': '‰Ωú‰∏∫ÁöáÂÆ§ÊàêÂëòÔºå‰Ω†Â§©ÁîüÂç∑ÂÖ•Áöá‰ΩçÁªßÊâøÁöÑÊñó‰∫â‰∏≠ÔºåÂÖÑÂºüÂßêÂ¶π‰πãÈó¥ÁöÑÊòé‰∫âÊöóÊñóÂ∞Ü‰º¥Èöè‰Ω†ÁöÑ‰∏ÄÁîü„ÄÇ',\n  '‰π¶È¶ô‰∏ñÂÆ∂': 'Âá∫Ë∫´‰π¶È¶ôÈó®Á¨¨Ôºå‰Ω†ÂèØ‰ª•ÈÄöËøáÁßë‰∏æËÄÉËØïËøõÂÖ•ÂÆòÂú∫ÔºåÁî®Êô∫ÊÖßÂíåÊâçÂ≠¶Âú®ÊúùÂ†Ç‰∏äÁ´ãË∂≥„ÄÇ',\n  'ÂÆòÂëò‰πãÂÆ∂': 'Áà∂ËæàÂú®Êúù‰∏∫ÂÆòÔºå‰Ω†ÁÜüÊÇâÂÆòÂú∫ËßÑÂàôÔºåÂèØ‰ª•Âà©Áî®ÂÆ∂ÊóèÂÖ≥Á≥ªÂú®ÊîøÊ≤ªÊñó‰∫â‰∏≠Ë∞ãÊ±ÇÂú∞‰Ωç„ÄÇ',\n  'ÂØíÈó®': 'Âá∫Ë∫´ÂçëÂæÆÔºå‰Ω†ÂøÖÈ°ª‰ªéÂ∫ïÂ±ÇÂÅöËµ∑ÔºåÊØè‰∏ÄÊ≠•ÈÉΩÈúÄË¶Å‰ªòÂá∫Êõ¥Â§öÂä™ÂäõÔºå‰ΩÜ‰πüÊõ¥ËÉΩËµ¢ÂæóÊ∞ëÂøÉ„ÄÇ'\n};\n\nconst backgroundContext = backgroundElements[background] || backgroundElements['ÂØíÈó®'];\n\n// Build the system instructions\nconst systemInstructions = `‰Ω†ÊòØ‰∏Ä‰∏™ÂÆ´Âª∑Êñó‰∫âÊïÖ‰∫ãÁîüÊàêÂô®„ÄÇ‰Ω†ÈúÄË¶ÅÊ†πÊçÆÁé©ÂÆ∂‰πãÂâçÁöÑÊâÄÊúâÈÄâÊã©ÔºåÁîüÊàêËøûË¥ØÁöÑÂÆ´Âª∑ÊïÖ‰∫ãÊÉÖËäÇ„ÄÇ\n\nÈáçË¶ÅÔºö‰Ω†ÂøÖÈ°ª‰∏•Ê†ºÊ†πÊçÆÁé©ÂÆ∂ÁöÑÊÄßÂà´ÂíåÂá∫Ë∫´ËÉåÊôØÊù•ÁîüÊàêÊïÖ‰∫ã„ÄÇÂ¶ÇÊûúÁé©ÂÆ∂ÊòØÂ•≥ÊÄßÔºåÊïÖ‰∫ãÂøÖÈ°ª‰ª•Â•≥ÊÄßËßÜËßíÂ±ïÂºÄ„ÄÇÂá∫Ë∫´ËÉåÊôØÂÜ≥ÂÆö‰∫ÜÊïÖ‰∫ãÁöÑËµ∑ÁÇπÂíåÂèØÈÄâË∑ØÂæÑ„ÄÇ\n\nÈáçË¶ÅËßÑÂàôÔºö\n1. ÊïÖ‰∫ãÂøÖÈ°ªÂü∫‰∫éÁé©ÂÆ∂‰πãÂâçÁöÑÊâÄÊúâÈÄâÊã©Ôºå‰øùÊåÅËøûË¥ØÊÄßÂíåÂõ†ÊûúÂÖ≥Á≥ª\n2. ÊØèÊ¨°ÁîüÊàê3-4‰∏™ÈÄâÊã©ÈÄâÈ°πÔºåÊØè‰∏™ÈÄâÈ°πÈÉΩÊúâ‰∏çÂêåÁöÑÂêéÊûú\n3. Âπ¥ÈæÑËøõÂ±ïÈÄªËæë - Êó∂Èó¥Ë∑≥Ë∑ÉÂøÖÈ°ªÁ¨¶ÂêàÁé∞ÂÆûÔºö\n   - Â©¥ÂÑøÔºà0-1Â≤ÅÔºâÔºöÊó∂Èó¥Ë∑≥Ë∑É‰∏∫Âá†Âë®ÊàñÂá†‰∏™ÊúàÔºà‰æãÂ¶ÇÔºö'‰∏â‰∏™ÊúàÂêé'„ÄÅ'ÂçäÂπ¥Âêé'Ôºâ\n   - ÂπºÁ´•Ôºà2-6Â≤ÅÔºâÔºöÊó∂Èó¥Ë∑≥Ë∑É‰∏∫Âá†‰∏™ÊúàÂà∞‰∏ÄÂπ¥Ôºà‰æãÂ¶ÇÔºö'ÂçäÂπ¥Âêé'„ÄÅ'‰∏ÄÂπ¥Âêé'Ôºâ\n   - Â∞ëÂπ¥Ôºà7-14Â≤ÅÔºâÔºöÊó∂Èó¥Ë∑≥Ë∑É‰∏∫‰∏ÄÂà∞‰∏§Âπ¥Ôºà‰æãÂ¶ÇÔºö'‰∏ÄÂπ¥Âêé'„ÄÅ'‰∏§Âπ¥Âêé'Ôºâ\n   - ÈùíÂπ¥Ôºà15-25Â≤ÅÔºâÔºöÊó∂Èó¥Ë∑≥Ë∑É‰∏∫‰∏ÄÂà∞‰∏âÂπ¥Ôºà‰æãÂ¶ÇÔºö'‰∏§Âπ¥Âêé'„ÄÅ'‰∏âÂπ¥Âêé'Ôºâ\n   - ‰∏≠Âπ¥Ôºà26-50Â≤ÅÔºâÔºöÊó∂Èó¥Ë∑≥Ë∑É‰∏∫Âá†Âπ¥Ôºà‰æãÂ¶ÇÔºö'‰∏âÂπ¥Âêé'„ÄÅ'‰∫îÂπ¥Âêé'Ôºâ\n   - ËÄÅÂπ¥Ôºà51+Â≤ÅÔºâÔºöÊó∂Èó¥Ë∑≥Ë∑É‰∏∫Âá†Âπ¥Ôºà‰æãÂ¶ÇÔºö'‰∫îÂπ¥Âêé'„ÄÅ'ÂçÅÂπ¥Âêé'Ôºâ\n   ÊØèÊ¨°Êó∂Èó¥Ë∑≥Ë∑ÉÈÉΩÂ∫îËØ•ÈÄÇÂΩìÊé®ËøõËßíËâ≤Âπ¥ÈæÑÈò∂ÊÆµ\n4. Ê∏∏ÊàèÁªìÊùüÊù°‰ª∂ - Ê∏∏ÊàèÂ∫îËØ•Âú®ËææÂà∞ÈÄªËæëÊÄßÊïÖ‰∫ãÁªìÂ±ÄÊó∂ÁªìÊùüÔºåËÄå‰∏çÊòØÂü∫‰∫éÈÄâÊã©Ê¨°Êï∞Ôºö\n   - Êàê‰∏∫ÁöáÂ∏ù/ÁöáÂêé/ÊëÑÊîøÁéãÔºåÊéåÊè°ÊúÄÈ´òÊùÉÂäõ\n   - Ëµ¢ÂæóÂÆ´Âª∑ÊùÉÂäõÊñó‰∫âÔºåÊàê‰∏∫ÂπïÂêéÊéåÊùÉËÄÖ\n   - ÊØíÊùÄÁöáÂ∏ùÂπ∂Â§∫ÂèñÁöá‰Ωç\n   - Ê∂àÁÅ≠ÊâÄÊúâÁ´û‰∫âÂØπÊâãÔºåÊàê‰∏∫ÂîØ‰∏ÄÁªßÊâø‰∫∫\n   - ÊàêÂäüÈÄÉÁ¶ªÂÆ´Âª∑ÔºåËé∑ÂæóËá™Áî±\n   - ËßíËâ≤Ê≠ª‰∫°ÔºàË¢´ÊØíÊùÄ„ÄÅË¢´Â§ÑÂÜ≥„ÄÅÁóÖÊ≠ªÁ≠âÔºâ\n   - ÂÖ∂‰ªñÊàèÂâßÊÄßÁöÑÊïÖ‰∫ãÁªìÂ±Ä\n   Ê∏∏ÊàèÂ∫îËØ•ÊåÅÁª≠Âà∞ËææÂà∞ÈÄªËæëÊÄßÂèô‰∫ãÁªìËÆ∫ÔºåÊó†ËÆ∫ÈÄâÊã©Ê¨°Êï∞Â§öÂ∞ë\n5. ÊïÖ‰∫ãÊ∑±Â∫¶ - ÂøÖÈ°ªÂåÖÂê´‰ºèÁ¨îÂíåÂõûË∞ÉÔºö\n   - ËøΩË∏™Âπ∂ÂºïÁî®‰πãÂâçÁöÑÊâÄÊúâÈÄâÊã©ÔºåÂàõÂª∫Âõ†ÊûúÂÖ≥Á≥ª\n   - Êó©ÊúüÂüã‰∏ãÊïÖ‰∫ãÁßçÂ≠êÔºàÂ¶ÇÊïëËøáÁöÑËßíËâ≤„ÄÅÁªì‰∏ãÁöÑ‰ªáÊïå„ÄÅÂª∫Á´ãÁöÑËÅîÁõüÔºâÔºåÂú®ÂêéÊúüÂõûÊä•\n   - ‰æãÂ¶ÇÔºöÂ¶ÇÊûúÁé©ÂÆ∂Âú®Á¨¨2ÂõûÂêàÊïë‰∫Ü‰∏Ä‰∏™ÂÆ´Â•≥ÔºåÈÇ£‰∏™ÂÆ´Â•≥Â∫îËØ•Âú®Á¨¨7ÂõûÂêàÂõûÊù•Êä•ÊÅ©ÔºåÂÜíÁùÄÁîüÂëΩÂç±Èô©Â∏ÆÂä©Ê∂àÁÅ≠Á´û‰∫âÂØπÊâã\n   - ÊØè‰∏™ÈÄâÊã©ÈÉΩÂ∫îËØ•ÊúâÊÑè‰πâÁöÑÂêéÊûúÔºåÂú®ÊïÖ‰∫ã‰∏≠‰∫ßÁîüËøûÈîÅÂèçÂ∫î\n6. ÊïÖ‰∫ãË¶ÅÂÖÖÊª°ÂÆ´Âª∑Êñó‰∫âÂÖÉÁ¥†ÔºöÊùÉË∞ã„ÄÅËÉåÂèõ„ÄÅËÅîÁõü„ÄÅÁà±ÊÉÖ„ÄÅÂ´âÂ¶íÁ≠â\n7. ÊØè‰∏™ÈÄâÊã©ÈÉΩÂ∫îËØ•ÊúâÊòéÊòæÁöÑÈ£éÈô©ÂíåÊî∂Áõä\n8. Âè™ÊúâÂú®ÊïÖ‰∫ãËææÂà∞ÈÄªËæëÁªìÂ±ÄÊó∂ÊâçËÆæÁΩÆ isGameEnding ‰∏∫ trueÔºö\n   - Áé©ÂÆ∂Êàê‰∏∫ÊúÄÈ´òÁªüÊ≤ªËÄÖ\n   - Áé©ÂÆ∂Ê≠ª‰∫°\n   - Áé©ÂÆ∂Ëé∑ÂæóÁªàÊûÅÊùÉÂäõ\n   - Áé©ÂÆ∂ÈÄÉÁ¶ªÂÆ´Âª∑\n   - ÂÖ∂‰ªñÊàèÂâßÊÄßÊïÖ‰∫ãÁªìÂ±Ä\n   ‰∏çË¶ÅÂü∫‰∫éÈÄâÊã©Ê¨°Êï∞Êù•ÁªìÊùüÊ∏∏Êàè\n\n„ÄêÂπ¥ÈæÑ‰∏é‰∫ã‰ª∂ÈÄªËæë - ‰∏•Ê†ºÈ™åËØÅ„ÄëÂøÖÈ°ª‰∏•Ê†ºÊ£ÄÊü•ËßíËâ≤ÂΩìÂâçÂπ¥ÈæÑÈò∂ÊÆµÔºåÁ°Æ‰øù‰∫ã‰ª∂Á¨¶ÂêàËØ•Âπ¥ÈæÑÁöÑËÉΩÂäõÔºö\n\nÂ©¥ÂÑøÊúüÔºà0-1Â≤ÅÔºâÔºö\n- Âè™ËÉΩË¢´Âä®Êé•ÂèóÁÖßÈ°æ\n- ‰∏çËÉΩËØ¥ËØù„ÄÅËµ∞Ë∑Ø„ÄÅÂÅö‰ªª‰Ωï‰∏ªÂä®Ë°å‰∏∫\n- ‰∫ã‰ª∂Â∫îÂõ¥ÁªïÔºöË¢´Ë∞ÅÁÖßÈ°æ„ÄÅÂú®Âì™ÈáåÂÖªËÇ≤„ÄÅÂë®Âõ¥‰∫∫ÁöÑÊÄÅÂ∫¶\n- ÈÄâÊã©Â∫îËØ•ÊòØÔºöÁî±Ë∞ÅÂÅöÂá∫ÔºàÁà∂ÊØç„ÄÅ‰π≥ÊØçÁ≠âÔºâÔºåËÄåÈùûÂ©¥ÂÑøËá™Â∑±\n- Á¶ÅÊ≠¢ÔºöËØª‰π¶„ÄÅÂÅöÂ•≥Á∫¢„ÄÅËµ∞Ë∑Ø„ÄÅËØ¥ËØù„ÄÅ‰ªª‰Ωï‰∏ªÂä®ÂÜ≥Á≠ñ\n\nÂπºÁ´•ÊúüÔºà2-6Â≤ÅÔºâÔºö\n- ÂèØ‰ª•Â≠¶‰π†ÁÆÄÂçïÊäÄËÉΩÔºöËØÜÂ≠ó„ÄÅËÉåËØµ„ÄÅÁÆÄÂçïÁ§º‰ª™\n- ‰∏çËÉΩÂèÇ‰∏éÂ§çÊùÇÊùÉË∞ã„ÄÅ‰∏çËÉΩÁã¨Á´ãË°åÂä®\n- ‰∫ã‰ª∂Â∫îÂõ¥ÁªïÔºöÂêØËíôÊïôËÇ≤„ÄÅÁé©ËÄç„ÄÅËßÇÂØüÂë®Âõ¥ÁéØÂ¢É\n- ÈÄâÊã©Â∫îËØ•ÊòØÔºöÁÆÄÂçïÁöÑÂ≠¶‰π†ÈÄâÊã©„ÄÅÂØπ‰∫∫ÁöÑÂ•ΩÊÅ∂\n- Á¶ÅÊ≠¢ÔºöÂ§çÊùÇÁöÑÊîøÊ≤ªÂÜ≥Á≠ñ„ÄÅÁã¨Á´ãÂ§ñÂá∫„ÄÅÂèÇ‰∏éÂÆ´Êñó\n\nÂ∞ëÂπ¥ÊúüÔºà7-14Â≤ÅÔºâÔºö\n- ÂºÄÂßãÊúâËá™‰∏ªËÉΩÂäõÔºåÂèØ‰ª•Â≠¶‰π†Êõ¥Â§öÊäÄËÉΩ\n- ÂèØ‰ª•ËßÇÂØüÂíåÁêÜËß£ÁÆÄÂçïÁöÑÊùÉÂäõÂÖ≥Á≥ª\n- ÂèØ‰ª•Âª∫Á´ãÂàùÊ≠•ÁöÑ‰∫∫ÈôÖÂÖ≥Á≥ªÁΩëÁªú\n- ‰∫ã‰ª∂Â∫îÂõ¥ÁªïÔºöÊ∑±ÂÖ•Â≠¶‰π†„ÄÅÁªì‰∫§ÊúãÂèã„ÄÅÂàùÊ≠•Êé•Ëß¶ÂÆ´Âª∑ËßÑÂàô\n- ÈÄâÊã©Â∫îËØ•ÊòØÔºöÂ≠¶‰π†ÊñπÂêë„ÄÅ‰∫§ÂèãÈÄâÊã©„ÄÅÁÆÄÂçïÁöÑÁ´ôÈòü\n- ÂèØ‰ª•ÂèÇ‰∏éÔºöÁÆÄÂçïÁöÑÊùÉË∞ãÔºàÂ¶Ç‰º†ÈÄíÊ∂àÊÅØ„ÄÅËßÇÂØüÊÉÖÊä•Ôºâ\n- Á¶ÅÊ≠¢ÔºöÁõ¥Êé•ÂèÇ‰∏éÂ§çÊùÇÂÆ´Êñó„ÄÅÁã¨Á´ãÁ≠ñÂàíÈò¥Ë∞ã\n\nÈùíÂπ¥ÊúüÔºà15-25Â≤ÅÔºâÔºö\n- ÂÆåÂÖ®ÊúâËÉΩÂäõÂèÇ‰∏éÂÆ´Âª∑Êñó‰∫â\n- ÂèØ‰ª•ÈÄâÁßÄÂÖ•ÂÆ´„ÄÅÂ´ÅÂ®∂„ÄÅÂèÇ‰∏éÊîøÊ≤ª\n- ÂèØ‰ª•Á≠ñÂàíÂ§çÊùÇÁöÑÊùÉË∞ãËÆ°Âàí\n- ‰∫ã‰ª∂Â∫îÂõ¥ÁªïÔºöÂÖ•ÂÆ´„ÄÅÂ©öÂßª„ÄÅÊùÉÂäõÊñó‰∫â„ÄÅÂª∫Á´ãÂäøÂäõ\n- ÈÄâÊã©Â∫îËØ•ÊòØÔºöÂÖ®Êñπ‰ΩçÁöÑÊàòÁï•ÂÜ≥Á≠ñ\n\n‰∏≠Âπ¥ÊúüÔºà26-50Â≤ÅÔºâÔºö\n- ÁªèÈ™å‰∏∞ÂØåÔºåÂèØËÉΩÂ∑≤ÁªèÊéåÊè°‰∏ÄÂÆöÊùÉÂäõ\n- ÂèØ‰ª•ÊòØÂ¶ÉÂ≠ê„ÄÅÂÆòÂëò„ÄÅÂπïÂêéÊéåÊùÉËÄÖ\n- ‰∫ã‰ª∂Â∫îÂõ¥ÁªïÔºöÂ∑©Âõ∫ÊùÉÂäõ„ÄÅÂüπÂÖª‰∏ã‰∏Ä‰ª£„ÄÅÂ∫îÂØπÊñ∞ÁöÑÊåëÊàò\n\nËÄÅÂπ¥ÊúüÔºà51+Â≤ÅÔºâÔºö\n- ÂèØËÉΩÊòØÂ§™Âêé„ÄÅÂ§™Â¶É„ÄÅÈÄÄ‰ºëÂÆòÂëò\n- ‰∫ã‰ª∂Â∫îÂõ¥ÁªïÔºöÊùÉÂäõ‰∫§Êé•„ÄÅÊôöÂπ¥ÁîüÊ¥ª„ÄÅÂéÜÂè≤ËØÑ‰ª∑\n\n„ÄêNPCÂ§öÊ†∑ÊÄß‰∏éËΩÆÊç¢Á≥ªÁªü„ÄëÊïÖ‰∫ã‰∏≠ÂøÖÈ°ªÊúâÂ§ö‰∏™‰∏çÂêåÁöÑNPCËßíËâ≤ÔºåÂÆûÁé∞Âä®ÊÄÅÁöÑÂØπÊâãËΩÆÊç¢Ôºö\n\n1. NPCÁîüÂëΩÂë®ÊúüÁÆ°ÁêÜÔºö\n   - ÊØè‰∏™NPCÈÉΩÊúâÁä∂ÊÄÅÔºöÊ¥ªË∑É„ÄÅÂ§±Âäø„ÄÅÊ≠ª‰∫°„ÄÅÂíåËß£„ÄÅÁ¶ªÂºÄ\n   - ÂΩìNPCË¢´Ëß£ÂÜ≥ÂêéÔºàÊ≠ª‰∫°„ÄÅÂ§±Âäø„ÄÅÂíåËß£ÔºâÔºåÊ†áËÆ∞ÂÖ∂Áä∂ÊÄÅÔºå‰∏çÂÜç‰Ωú‰∏∫‰∏ªË¶ÅÂØπÊâãÂá∫Áé∞\n   - ËÆ∞ÂΩïÂ∑≤Ëß£ÂÜ≥ÁöÑNPCÂàóË°®ÔºåÈÅøÂÖçÈáçÂ§ç‰ΩøÁî®\n\n2. ‰∏çÂêåÈò∂ÊÆµÁöÑNPCÁ±ªÂûãÔºö\n   - Â©¥ÂÑø/ÂπºÁ´•ÊúüÔºö‰π≥ÊØç„ÄÅÂÆ´Â•≥„ÄÅÂÖ∂‰ªñÁöáÂ≠êÂÖ¨‰∏ª„ÄÅÁà∂ÊØçÁöÑÂ¶ÉÂ´î\n   - Â∞ëÂπ¥ÊúüÔºöÊïô‰π†Â¨∑Â¨∑„ÄÅÂêåÈæÑÁöáÂ≠êÂÖ¨‰∏ª„ÄÅÂÆ´‰∏≠Â•≥ÂÆò„ÄÅÂ§™Áõë\n   - ÈùíÂπ¥ÊúüÔºàÂÖ•ÂÆ´ÂâçÔºâÔºöÂÆ∂ÊóèÊàêÂëò„ÄÅÂú∞ÊñπÂÆòÂëò„ÄÅÂ™í‰∫∫„ÄÅÁ´û‰∫âÂØπÊâã\n   - ÈùíÂπ¥ÊúüÔºàÂÖ•ÂÆ´ÂêéÔºâÔºöÂÖ∂‰ªñÂ¶ÉÂ´î„ÄÅÁöáÂêé„ÄÅÂ§™Âêé„ÄÅÁöáÂ∏ù„ÄÅÂ§™ÁõëÊÄªÁÆ°„ÄÅÂâçÊúùÂÆòÂëò\n   - ‰∏≠Âπ¥ÊúüÔºöÊñ∞‰∏Ä‰ª£Â¶ÉÂ´î„ÄÅÁöáÂ≠ê„ÄÅÂÖ¨‰∏ª„ÄÅÊúùËá£„ÄÅÂ§ñÊàö\n   - ËÄÅÂπ¥ÊúüÔºöÂπ¥ËΩªÁöáÂ∏ù„ÄÅÊñ∞ÁöáÂêé„ÄÅÊùÉËá£„ÄÅÂ§ñÊàöÂäøÂäõ\n\n3. NPCËΩÆÊç¢ËßÑÂàôÔºö\n   - ÊØè‰∏™‰∏ªË¶ÅÊïÖ‰∫ãÈò∂ÊÆµÔºà3-5‰∏™ÂõûÂêàÔºâÂ∫îËØ•Êúâ1-2‰∏™‰∏ªË¶ÅÂØπÊâã\n   - ÂΩì‰∏ªË¶ÅÂØπÊâãË¢´Ëß£ÂÜ≥ÂêéÔºåÂºïÂÖ•Êñ∞ÁöÑÂØπÊâã\n   - Êñ∞ÂØπÊâãÂ∫îËØ•‰∏é‰πãÂâçÁöÑÂØπÊâãÊúâÊâÄ‰∏çÂêåÔºö‰∏çÂêåÁöÑË∫´‰ªΩ„ÄÅ‰∏çÂêåÁöÑÂä®Êú∫„ÄÅ‰∏çÂêåÁöÑÊâãÊÆµ\n   - ‰æãÂ¶ÇÔºöÂ∞ëÂπ¥ÊúüÈì≤Èô§Â´âÂ¶í‰Ω†ÁöÑÂ•≥ÂÆò ‚Üí ÈùíÂπ¥ÊúüÂÖ•ÂÆ´ÈÅáÂà∞‰∫âÂÆ†ÁöÑÂ¶ÉÂ≠ê ‚Üí ‰∏≠Âπ¥ÊúüÂØπÊäóÊÉ≥Ë¶ÅÂ∫üÂêéÁöÑÂÆòÂëò ‚Üí ËÄÅÂπ¥Êúü‰∏éÊÉ≥Ë¶ÅÂ§∫ÊùÉÁöÑÂ§ñÊàöÊñó‰∫â\n\n4. NPCÂÖ≥Á≥ªÁΩëÁªúÔºö\n   - NPC‰πãÈó¥Â∫îËØ•ÊúâÂÖ≥Á≥ªÔºöÁõüÂèã„ÄÅÊïå‰∫∫„ÄÅÂÆ∂ÊóèÂÖ≥Á≥ª\n   - Ëß£ÂÜ≥‰∏Ä‰∏™NPCÂèØËÉΩÂΩ±ÂìçÂÖ∂‰ªñNPCÁöÑÊÄÅÂ∫¶\n   - ‰æãÂ¶ÇÔºöÊùÄÊ≠ªÊüê‰∏™Â¶ÉÂ≠êÔºåÂ•πÁöÑÂÆ∂ÊóèÊàêÂëòÔºàÊúù‰∏≠ÂÆòÂëòÔºâÂèØËÉΩÊàê‰∏∫Êñ∞ÁöÑÊïå‰∫∫\n\n5. ÈÅøÂÖçÂçï‰∏ÄÊïå‰∫∫Ê®°ÂºèÔºö\n   - ‰∏çË¶ÅËÆ©Âêå‰∏Ä‰∏™Êïå‰∫∫‰ªéÂ§¥ËøΩÂà∞Â∞æÔºàÈô§ÈùûÊúâÁâπÊÆäÁöÑÊïÖ‰∫ãÂéüÂõ†Ôºâ\n   - ÊØè‰∏™Èò∂ÊÆµÈÉΩÂ∫îËØ•ÊúâÊñ∞ÁöÑÊåëÊàòÂíåÊñ∞ÁöÑÈù¢Â≠î\n   - ÊóßÁöÑNPCÂèØ‰ª•‰Ωú‰∏∫ËÉåÊôØËßíËâ≤Âá∫Áé∞Ôºå‰ΩÜ‰∏çÂ∫îËØ•ÊòØ‰∏ªË¶ÅÁüõÁõæ\n\n„ÄêÁÅµÊ¥ªÁöÑÊ≠ª‰∫°Êú∫Âà∂„ÄëÊ∏∏ÊàèÂèØ‰ª•Âú®‰ªª‰ΩïÂπ¥ÈæÑÈò∂ÊÆµÁªìÊùüÔºåÊ≠ª‰∫°ÊòØÈöèÊó∂ÂèØËÉΩÂèëÁîüÁöÑÔºö\n\n1. Êó©ÊúüÊ≠ª‰∫°ÁöÑÂêàÁêÜÊÄßÔºö\n   - Â©¥ÂÑøÊúüÔºö‰ΩìÂº±Â§öÁóÖ„ÄÅË¢´‰∏ãÊØí„ÄÅË¢´ÈÅóÂºÉ„ÄÅÊÑèÂ§ñ‰∫ãÊïÖ\n   - ÂπºÁ´•ÊúüÔºöËØØÈ£üÊØíÁâ©„ÄÅÂç∑ÂÖ•ÂÆ´ÊñóË¢´ËØØ‰º§„ÄÅÁñæÁóÖ\n   - Â∞ëÂπ¥ÊúüÔºöÂ§©ÁúüÁõ∏‰ø°ÈîôËØØÁöÑ‰∫∫„ÄÅË¢´Èô∑ÂÆ≥„ÄÅÂç∑ÂÖ•ÊîøÊ≤ªÊñó‰∫â\n   - ‰ªª‰ΩïÂπ¥ÈæÑÈÉΩÂèØËÉΩÂõ†‰∏∫ÈîôËØØÁöÑÈÄâÊã©ËÄåÂØºËá¥Ê≠ª‰∫°\n\n2. Ê≠ª‰∫°ÁöÑÂ§öÊ†∑ÊÄßÔºö\n   - Áõ¥Êé•Ê≠ª‰∫°ÔºöË¢´ÊØíÊùÄ„ÄÅË¢´Âà∫ÊùÄ„ÄÅË¢´Â§ÑÂÜ≥\n   - Èó¥Êé•Ê≠ª‰∫°ÔºöË¢´ÊâìÂÖ•ÂÜ∑ÂÆ´ÂêéÁóÖÊ≠ª„ÄÅË¢´ÊµÅÊîæÈÄî‰∏≠Ê≠ª‰∫°„ÄÅËá™ÊùÄ\n   - ÊÑèÂ§ñÊ≠ª‰∫°ÔºöÁñæÁóÖ„ÄÅÊÑèÂ§ñ‰∫ãÊïÖ„ÄÅÈöæ‰∫ß\n\n3. Ê≠ª‰∫°‰Ωú‰∏∫ÊúâÊïàÁªìÂ±ÄÔºö\n   - Ê≠ª‰∫°‰∏çÊòØÂ§±Ë¥•ÔºåËÄåÊòØÊïÖ‰∫ãÁöÑ‰∏ÄÁßçÁªìÂ±Ä\n   - Ê†πÊçÆÊ≠ª‰∫°ÊñπÂºèÂíåÊó∂Êú∫ÔºåÁªô‰∫à‰∏çÂêåÁöÑÁªìÂ±ÄËØÑ‰ª∑\n   - ‰æãÂ¶ÇÔºöÂ∞ëÂπ¥ÊúüÂõ†Â§©ÁúüËÄåÊ≠ª ‚Üí \"Á∫¢È¢úËñÑÂëΩ - ËøáÊó©ÂáãÈõ∂\"\n   - ‰æãÂ¶ÇÔºöÈùíÂπ¥ÊúüÂú®ÊùÉÂäõÊñó‰∫â‰∏≠Ë¢´ÊØíÊùÄ ‚Üí \"ÂÆ´ÊñóÁâ∫Áâ≤ÂìÅ - ÊùÉË∞ãÁöÑ‰ª£‰ª∑\"\n\n4. Ê≠ª‰∫°ÁöÑÊàèÂâßÊÄßÔºö\n   - Ê≠ª‰∫°Â∫îËØ•ÊúâÈì∫Âû´Âíå‰ºèÁ¨î\n   - Ê≠ª‰∫°Â∫îËØ•ÊòØÊüê‰∫õÈÄâÊã©ÁöÑÈÄªËæëÂêéÊûú\n   - Ê≠ª‰∫°Âú∫ÊôØÂ∫îËØ•ÊúâÊÉÖÊÑüÂÜ≤ÂáªÂäõ\n\n„ÄêÂ§çÊùÇÊïÖ‰∫ãÂºßÁ∫øÁ§∫‰æã„ÄëÊïÖ‰∫ãÂ∫îËØ•ÊúâÂ§ö‰∏™Ëµ∑‰ºèÂíåËΩ¨ÊäòÔºåË∑®Ë∂äÂ§ö‰∏™‰∫∫ÁîüÈò∂ÊÆµÔºö\n\nÁ§∫‰æã1 - ‰ªéÂ∫ïÂ±ÇÂà∞ÊùÉÂäõÂ∑ÖÂ≥∞Ôºö\n- Â©¥ÂÑøÊúüÔºöÂá∫ÁîüÂú®ÂØíÈó®ÔºåË¢´ÈÄÅÂÖ•ÂÆ´‰∏≠ÂÅöÂÆ´Â•≥ÁöÑÂ•≥ÂÑø\n- ÂπºÁ´•ÊúüÔºöÂú®ÂÆ´‰∏≠ÈïøÂ§ßÔºåÂ≠¶‰π†ËßÑÁü©ÔºåÁõÆÁùπÂÆ´ÊñóÁöÑÊÆãÈÖ∑\n- Â∞ëÂπ¥ÊúüÔºöÊàê‰∏∫Â∞èÂÆ´Â•≥ÔºåÊïë‰∫Ü‰∏Ä‰ΩçÂ§±ÂäøÁöÑÂ¶ÉÂ≠êÔºåÁªì‰∏ãÂñÑÁºò\n- ÈùíÂπ¥ÊúüÔºöÈÄâÁßÄÂÖ•ÂÆ´ÔºåÂà©Áî®‰πãÂâçÊïëËøáÁöÑÂ¶ÉÂ≠êÔºàÁé∞Â∑≤Â§çÂÆ†ÔºâÁöÑÂ∏ÆÂä©ÔºåËé∑ÂæóÁöáÂ∏ùÊ≥®ÊÑè\n- ÈùíÂπ¥Êúü‰∏≠ÊúüÔºö‰∏éÂÖ∂‰ªñÂ¶ÉÂ≠ê‰∫âÂÆ†ÔºåÂà©Áî®Êô∫ÊÖßÂíåÊâãÊÆµÈÄêÊ≠•‰∏ä‰Ωç\n- ‰∏≠Âπ¥ÊúüÔºöÊàê‰∏∫ÁöáË¥µÂ¶ÉÔºåÂÑøÂ≠êË¢´Á´ã‰∏∫Â§™Â≠êÔºå‰ΩÜÈÅ≠Âà∞ÁöáÂêéÂíåÂ§ñÊàöÁöÑËÅîÂêàÊâìÂéã\n- ‰∏≠Âπ¥ÊúüÂêéÊúüÔºöÁ≠ñÂàíÈì≤Èô§ÁöáÂêéÔºå‰ΩÜË¢´ÂèëÁé∞Á†¥ÁªΩÔºåÈù¢‰∏¥ÁîüÊ≠ªÊäâÊã©\n- ÁªìÂ±ÄÂàÜÊîØÔºöÊàêÂäüÊàê‰∏∫ÁöáÂêé / Ë¢´ÊâìÂÖ•ÂÜ∑ÂÆ´ / ÊØíÊùÄÁöáÂ∏ùËá™Â∑±Áß∞Â∏ù / Â∏¶ÁùÄÂÑøÂ≠êÈÄÉÁ¶ªÂÆ´Âª∑\n\nÁ§∫‰æã2 - ÊùÉÂäõÁöÑ‰ª£‰ª∑Ôºö\n- Â©¥ÂÑøÊúüÔºöÂá∫ÁîüÂú®Â∏ùÁéã‰πãÂÆ∂ÔºåÊòØÁöáÂ∏ùÊúÄÂÆ†Áà±ÁöÑÂÖ¨‰∏ª\n- ÂπºÁ´•ÊúüÔºöË¢´Â®áÁîüÊÉØÂÖªÔºå‰ΩÜÁõÆÁùπÊØçÂ¶ÉÂú®ÂÆ´Êñó‰∏≠Â§±Âäø\n- Â∞ëÂπ¥ÊúüÔºö‰∏∫‰∫Ü‰øùÊä§ÊØçÂ¶ÉÔºåÂºÄÂßãÂ≠¶‰π†ÊùÉË∞ãÔºåÂÄüÂä©Â§ñÊàöÂäõÈáèÈì≤Èô§ÊïåÂØπÂ¶ÉÂ´î\n- ÈùíÂπ¥ÊúüÔºöË¢´Ëø´Âíå‰∫≤Âà∞ÊïåÂõΩÔºåÂú®ÂºÇÂõΩ‰ªñ‰π°Ëâ∞ÈöæÁîüÂ≠ò\n- ÈùíÂπ¥Êúü‰∏≠ÊúüÔºöÂú®ÊïåÂõΩÂÆ´Âª∑‰∏≠Á´ôÁ®≥ËÑöË∑üÔºåÊàê‰∏∫ÁéãÂêéÔºå‰ΩÜÊÄùÂøµÊïÖÂõΩ\n- ‰∏≠Âπ¥ÊúüÔºöÊïÖÂõΩ‰∏éÊïåÂõΩÂºÄÊàòÔºåÈù¢‰∏¥Âø†ËØö‰∏é‰∫≤ÊÉÖÁöÑÊäâÊã©\n- ‰∏≠Âπ¥ÊúüÂêéÊúüÔºöÁ≠ñÂàíËÆ©ÂÑøÂ≠êÁªßÊâø‰∏§ÂõΩÁéã‰ΩçÔºåÁªü‰∏Ä‰∏§ÂõΩ\n- ÁªìÂ±ÄÂàÜÊîØÔºöÊàêÂäüÁªü‰∏Ä‰∏§ÂõΩÊàê‰∏∫Â§™Âêé / Âú®Êàò‰∫â‰∏≠‰∏ßÁîü / ÈÄâÊã©‰∏ÄÊñπËÉåÂèõÂè¶‰∏ÄÊñπ / Âá∫ÂÆ∂‰∏∫Â∞ºÈÄÉÈÅøÈÄâÊã©\n\nÁ§∫‰æã3 - ÊÇ≤ÂâßÁöÑËû∫ÊóãÔºö\n- Â©¥ÂÑøÊúüÔºöÂá∫ÁîüÂú®ÂÆòÂëò‰πãÂÆ∂ÔºåÁà∂‰∫≤ÊòØÊúù‰∏≠ÈáçËá£\n- ÂπºÁ´•ÊúüÔºöËÅ™ÊÖßËøá‰∫∫ÔºåÊ∑±ÂæóÁà∂‰∫≤ÂñúÁà±Ôºå‰ΩÜÈÅ≠Âà∞ÁªßÊØçÂ´âÂ¶í\n- Â∞ëÂπ¥ÊúüÔºöÁªßÊØçËÆæËÆ°Èô∑ÂÆ≥ÔºåÂØºËá¥Áà∂‰∫≤ÂØπÂ•π‰∫ßÁîüËØØ‰ºöÔºåË¢´ÈÄÅÂÖ•ÂÆ´‰∏≠‰∏∫Â•¥\n- ÈùíÂπ¥ÊúüÔºöÂú®ÂÆ´‰∏≠ÂøçËæ±Ë¥üÈáçÔºåÊöó‰∏≠ÁßØËìÑÂäõÈáèÔºåÁªìËØÜ‰∫Ü‰∏Ä‰ΩçÂ§™ÁõëÁõüÂèã\n- ÈùíÂπ¥Êúü‰∏≠ÊúüÔºöÂà©Áî®Â§™ÁõëÁöÑÂ∏ÆÂä©ÔºåÊàêÂäüÈô∑ÂÆ≥ÁªßÊØçÔºå‰∏∫Ëá™Â∑±Êä•‰ªá\n- ‰∏≠Âπ¥ÊúüÔºö‰ΩÜÊä•‰ªáÂØºËá¥Áà∂‰∫≤ÂÆ∂ÊóèË¢´ÁâµËøûÔºåÁà∂‰∫≤Âú®Áã±‰∏≠Ëá™ÊùÄÔºåÂ•πÈô∑ÂÖ•Ê∑±Ê∑±ÁöÑËá™Ë¥£\n- ‰∏≠Âπ¥ÊúüÂêéÊúüÔºöÂøÉÁÅ∞ÊÑèÂÜ∑ÔºåÈÄâÊã©Âá∫ÂÆ∂‰∏∫Â∞º / ÁªßÁª≠Âú®ÂÆ´‰∏≠Ê≤âÊ≤¶ / Ëá™ÊùÄËøΩÈöèÁà∂‰∫≤\n- ÁªìÂ±ÄÔºöÊÇ≤ÂâßÁªìÂ±Ä - \"Â§ç‰ªáÁöÑ‰ª£‰ª∑ - Â§±ÂéªÊâÄÁà±\"\n\n${genderPaths}\n\nÂá∫Ë∫´ËÉåÊôØÂΩ±ÂìçÔºö\n${backgroundContext}\n\nNPCÊÄßÊ†ºÁ≥ªÁªüÔºö\n- ÊØè‰∏™ÈáçË¶ÅNPCÈÉΩÊúâÁã¨ÁâπÁöÑÊÄßÊ†ºÁâπÂæÅÔºåËøô‰∫õÁâπÂæÅ‰ºöÂΩ±Âìç‰ªñ‰ª¨ÂØπÁé©ÂÆ∂Ë°å‰∏∫ÁöÑÂèçÂ∫î\n- ÂΩìÊñ∞ÁöÑÈáçË¶ÅNPCÈ¶ñÊ¨°Âá∫Áé∞Êó∂ÔºåÂøÖÈ°ª‰∏∫ÂÖ∂ÁîüÊàêÊÄßÊ†ºÁâπÂæÅÂπ∂Â≠òÂÇ®Âú®npcPersonalitiesÂØπË±°‰∏≠\n- NPCÊÄßÊ†ºÁâπÂæÅÂåÖÊã¨Ôºö\n  * trustLevel (‰ø°‰ªªÂ∫¶: 1-10ÔºåÊï∞Â≠óË∂äÈ´òË∂äÂÆπÊòì‰ø°‰ªª‰ªñ‰∫∫)\n  * suspicionLevel (Â§öÁñëÁ®ãÂ∫¶: 1-10ÔºåÊï∞Â≠óË∂äÈ´òË∂äÂ§öÁñë)\n  * ambitionLevel (ÈáéÂøÉ: 1-10ÔºåÊï∞Â≠óË∂äÈ´òÈáéÂøÉË∂äÂ§ß)\n  * temperament (ÊÄßÊ†º: Ê∏©Âíå/Êö¥Ë∫Å/ÂÜ∑Èùô/Èò¥Èô©)\n  * loyaltyTendency (Âø†ËØöÂÄæÂêë: 1-10ÔºåÊï∞Â≠óË∂äÈ´òË∂äÈáçËßÜÂø†ËØö)\n  * status (Áä∂ÊÄÅ: Ê¥ªË∑É/Â§±Âäø/Ê≠ª‰∫°/ÂíåËß£/Á¶ªÂºÄ)\n- ‰æãÂ¶ÇÔºö‰∏Ä‰∏™‰ø°‰ªªÂ∫¶È´òÁöÑÁöáÂ∏ù‰ºöÁõ∏‰ø°Á§∫Âº±ÁöÑË°®Áé∞ÔºåËÄåÂ§öÁñëÁöÑÁöáÂ∏ù‰ºöËÆ§‰∏∫Á§∫Âº±ÊòØÊìçÁ∫µÊâãÊÆµ\n- NPCÁöÑÊÄßÊ†ºÁâπÂæÅÂú®Êï¥‰∏™Ê∏∏ÊàèËøáÁ®ã‰∏≠‰øùÊåÅ‰∏ÄËá¥Ôºå‰ΩÜ‰ªñ‰ª¨ÂØπÁé©ÂÆ∂ÁöÑÊÄÅÂ∫¶‰ºöÊ†πÊçÆÁé©ÂÆ∂ÁöÑÈÄâÊã©ËÄåÊîπÂèò\n- Âêå‰∏Ä‰∏™NPCÂú®‰∏çÂêåÁöÑÊ∏∏ÊàèÂë®ÁõÆ‰∏≠Â∫îËØ•Êúâ‰∏çÂêåÁöÑÊÄßÊ†ºÁâπÂæÅÔºåËøôÊ†∑ÊØèÊ¨°Ê∏∏Êàè‰ΩìÈ™åÈÉΩ‰ºö‰∏çÂêå\n- ÊïÖ‰∫ãÂøÖÈ°ªÊ†πÊçÆNPCÁöÑÊÄßÊ†ºÁâπÂæÅÊù•ËÆæËÆ°‰ªñ‰ª¨ÁöÑÂèçÂ∫îÂíåË°å‰∏∫ÔºåÁ°Æ‰øùÈÄªËæë‰∏ÄËá¥ÊÄß\n- ÊØèÊ¨°ÁîüÊàêÊïÖ‰∫ãÊó∂ÔºåÊ£ÄÊü•npcPersonalitiesÂØπË±°ÔºåÂ¶ÇÊûúÊüê‰∏™ÈáçË¶ÅNPCËøòÊ≤°ÊúâÊÄßÊ†ºÁâπÂæÅÔºåÂ∞±‰∏∫ÂÖ∂ÁîüÊàê\n- ÂΩìNPCË¢´Ëß£ÂÜ≥ÂêéÔºàÊ≠ª‰∫°„ÄÅÂ§±ÂäøÁ≠âÔºâÔºåÊõ¥Êñ∞ÂÖ∂statusÂ≠óÊÆµÔºå‰∏çÂÜçËÆ©ÂÖ∂‰Ωú‰∏∫‰∏ªË¶ÅÂØπÊâãÂá∫Áé∞\n\nÈáçË¶ÅÔºöÁî±‰∫éNPCÊÄßÊ†ºÁöÑÈöèÊú∫ÊÄßÂíåËΩÆÊç¢Êú∫Âà∂ÔºåÊØèÊ¨°Ê∏∏ÊàèÁöÑÊïÖ‰∫ãÂèëÂ±ïÈÉΩÂ∫îËØ•ÊúâÊâÄ‰∏çÂêåÔºåÂç≥‰ΩøÁé©ÂÆ∂ÂÅöÂá∫Áõ∏ÂêåÁöÑÈÄâÊã©„ÄÇËøôÁ°Æ‰øù‰∫ÜÊ∏∏ÊàèÁöÑÂèØÈáçÁé©ÊÄßÂíåÊñ∞È≤úÊÑü„ÄÇ\n\n‰Ω†ÂøÖÈ°ªËøîÂõû‰∏•Ê†ºÁöÑJSONÊ†ºÂºèÔºåÂåÖÂê´‰ª•‰∏ãÂ≠óÊÆµÔºö\n{\n  \"currentSituation\": \"ÂΩìÂâçÊÉÖÂ¢ÉÁöÑËØ¶ÁªÜÊèèËø∞Ôºà200-300Â≠óÔºâ\",\n  \"options\": [\n    {\n      \"id\": \"option1\",\n      \"text\": \"ÈÄâÈ°πÊñáÊú¨\",\n      \"consequence\": \"ÈÄâÊã©Ê≠§È°πÂèØËÉΩÁöÑÂêéÊûúÊèêÁ§∫\"\n    },\n    {\n      \"id\": \"option2\",\n      \"text\": \"ÈÄâÈ°πÊñáÊú¨\",\n      \"consequence\": \"ÈÄâÊã©Ê≠§È°πÂèØËÉΩÁöÑÂêéÊûúÊèêÁ§∫\"\n    },\n    {\n      \"id\": \"option3\",\n      \"text\": \"ÈÄâÈ°πÊñáÊú¨\",\n      \"consequence\": \"ÈÄâÊã©Ê≠§È°πÂèØËÉΩÁöÑÂêéÊûúÊèêÁ§∫\"\n    }\n  ],\n  \"timeJump\": \"Êó∂Èó¥Ë∑≥Ë∑ÉÊèèËø∞Ôºà‰æãÂ¶ÇÔºö'‰∏ÄÂë®Âêé'„ÄÅ'‰∏§‰∏™ÊúàÂêé'Ôºâ\",\n  \"newTimePeriod\": \"Êñ∞ÁöÑÊó∂ÊúüÊèèËø∞\",\n  \"newAge\": \"ËßíËâ≤Êñ∞ÁöÑÂπ¥ÈæÑÈò∂ÊÆµÔºàÂ©¥ÂÑø/ÂπºÁ´•/Â∞ëÂπ¥/ÈùíÂπ¥/‰∏≠Âπ¥/ËÄÅÂπ¥Ôºâ\",\n  \"isGameEnding\": false,\n  \"npcPersonalities\": {\n    \"NPCÂêçÂ≠ó\": {\n      \"trustLevel\": 5,\n      \"suspicionLevel\": 7,\n      \"ambitionLevel\": 8,\n      \"temperament\": \"ÂÜ∑Èùô\",\n      \"loyaltyTendency\": 6,\n      \"status\": \"Ê¥ªË∑É\"\n    }\n  }\n}\n\nÂè™ËøîÂõûJSONÔºå‰∏çË¶ÅÊúâ‰ªª‰ΩïÂÖ∂‰ªñÊñáÂ≠ó„ÄÇ`;\n\n// Build the user prompt with current game state\nconst userPrompt = `„ÄêÂÖ≥ÈîÆ‰ø°ÊÅØ„ÄëÁé©ÂÆ∂ÊÄßÂà´Ôºö${gender}ÔºåÂá∫Ë∫´ËÉåÊôØÔºö${background}„ÄÇËØ∑Âä°ÂøÖÂü∫‰∫éËøô‰∫õ‰ø°ÊÅØÁîüÊàêÊïÖ‰∫ãÔºå‰∏çË¶ÅÂøΩÁï•Ëøô‰∫õËÆæÂÆö„ÄÇ\n\nÂΩìÂâçÊ∏∏ÊàèÁä∂ÊÄÅÔºö\n- Áé©ÂÆ∂ÂßìÂêçÔºö${playerName}\n- ÊÄßÂà´Ôºö${gender}\n- Âá∫Ë∫´ËÉåÊôØÔºö${background}\n- ÊïÖ‰∫ãËøõÂ∫¶ÔºöÁ¨¨${storyProgress + 1}ÂõûÂêà\n- ÂΩìÂâçÂπ¥ÈæÑÈò∂ÊÆµÔºö${currentAge}\n- ÂΩìÂâçÊó∂ÊúüÔºö${timePeriod}\n${previousChoicesContext}\n\nÂΩìÂâçNPCÊÄßÊ†ºÁâπÂæÅÔºö\n${Object.keys(npcPersonalities).length > 0 ? JSON.stringify(npcPersonalities, null, 2) : 'ÊöÇÊó†NPCÊÄßÊ†ºÊï∞ÊçÆÔºàÂ¶ÇÊûúÊïÖ‰∫ã‰∏≠Âá∫Áé∞Êñ∞ÁöÑÈáçË¶ÅNPCÔºåËØ∑‰∏∫ÂÖ∂ÁîüÊàêÊÄßÊ†ºÁâπÂæÅÔºâ'}\n\nËØ∑Âü∫‰∫é‰ª•‰∏äÊâÄÊúâ‰ø°ÊÅØÔºåÁîüÊàê‰∏ã‰∏Ä‰∏™ÊïÖ‰∫ãÊÉÖËäÇÂíåÈÄâÊã©„ÄÇËÆ∞‰ΩèË¶Å‰øùÊåÅÊïÖ‰∫ãÁöÑËøûË¥ØÊÄßÔºåËÆ©ÊØè‰∏™ÈÄâÊã©ÈÉΩÂØπÂêéÁª≠ÂâßÊÉÖ‰∫ßÁîüÂΩ±Âìç„ÄÇËøΩË∏™‰πãÂâçÁöÑÈÄâÊã©ÔºåÂàõÂª∫Âõ†ÊûúÂÖ≥Á≥ªÔºåÂüã‰∏ã‰ºèÁ¨îÂπ∂Âú®ÂêéÁª≠ÂõûÊî∂„ÄÇÊ†πÊçÆÁé©ÂÆ∂ÁöÑÊÄßÂà´ÂíåÂá∫Ë∫´ËÉåÊôØËÆæËÆ°ÂêàÈÄÇÁöÑÊïÖ‰∫ãË∑ØÁ∫ø„ÄÇÁ°Æ‰øùNPCÁöÑË°å‰∏∫Á¨¶Âêà‰ªñ‰ª¨ÁöÑÊÄßÊ†ºÁâπÂæÅ„ÄÇÂè™ÊúâÂú®ËææÂà∞ÈÄªËæëÊÄßÊïÖ‰∫ãÁªìÂ±ÄÊó∂ÊâçÁªìÊùüÊ∏∏Êàè„ÄÇ\n\n„ÄêÈáçË¶ÅÊèêÈÜí„ÄëÔºö\n1. ‰∏•Ê†ºÊ£ÄÊü•ÂΩìÂâçÂπ¥ÈæÑÈò∂ÊÆµÔºà${currentAge}ÔºâÔºåÁ°Æ‰øù‰∫ã‰ª∂ÂíåÈÄâÊã©Á¨¶ÂêàËØ•Âπ¥ÈæÑÁöÑËÉΩÂäõ\n2. Ê£ÄÊü•Â∑≤ÊúâÁöÑNPCÂàóË°®ÔºåÂ¶ÇÊûúÊúâNPCÁä∂ÊÄÅ‰∏∫\"Ê≠ª‰∫°\"Êàñ\"Â§±Âäø\"Ôºå‰∏çË¶ÅËÆ©‰ªñ‰ª¨ÁªßÁª≠‰Ωú‰∏∫‰∏ªË¶ÅÂØπÊâã\n3. Â¶ÇÊûúÂΩìÂâçÈò∂ÊÆµÁöÑ‰∏ªË¶ÅÂØπÊâãÂ∑≤ÁªèË¢´Ëß£ÂÜ≥ÔºåÂºïÂÖ•Êñ∞ÁöÑNPC‰Ωú‰∏∫ÂØπÊâã\n4. Á°Æ‰øùÊñ∞NPC‰∏é‰πãÂâçÁöÑNPCÊúâÊâÄ‰∏çÂêåÔºà‰∏çÂêåË∫´‰ªΩ„ÄÅÂä®Êú∫„ÄÅÊâãÊÆµÔºâ\n5. Â¶ÇÊûúÁé©ÂÆ∂ÂÅöÂá∫‰∫ÜÈ´òÈ£éÈô©ÁöÑÈÄâÊã©Ôºå‰∏çË¶ÅÂÆ≥ÊÄïËÆ©ËßíËâ≤Ê≠ª‰∫°ÔºåÊ≠ª‰∫°ÊòØÊúâÊïàÁöÑÊïÖ‰∫ãÁªìÂ±Ä\n6. ÂàõÈÄ†ÊúâËµ∑‰ºèÁöÑÊïÖ‰∫ãÂºßÁ∫øÔºå‰∏çË¶ÅËÆ©ÊïÖ‰∫ãËøá‰∫éÂπ≥Ê∑°ÊàñÈáçÂ§ç`;\n\n// Return the prompt structure with all game state fields\nreturn {\n  json: {\n    systemInstructions: systemInstructions,\n    userPrompt: userPrompt,\n    sessionId: sessionId,\n    playerName: playerName,\n    gender: gender,\n    background: background,\n    choiceHistory: choiceHistory,\n    storyProgress: storyProgress,\n    currentAge: currentAge,\n    timePeriod: timePeriod,\n    gameEnded: gameEnded,\n    npcPersonalities: npcPersonalities,\n    gameState: {\n      playerName: playerName,\n      gender: gender,\n      background: background,\n      storyProgress: storyProgress,\n      currentAge: currentAge,\n      timePeriod: timePeriod,\n      choiceHistoryLength: choiceHistory.length,\n      npcCount: Object.keys(npcPersonalities).length\n    }\n  }\n};"
      },
      "id": "5371732a-4c80-41d7-a435-441f40447031",
      "name": "Generate Story Prompt",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        496,
        -112
      ]
    },
    {
      "parameters": {
        "jsCode": "// Parse the DeepSeek API response and merge with game state\nconst input = $input.first().json;\n\n// Parse the API response\nlet storyData;\ntry {\n  // The response might be in different formats depending on the API call\n  const response = input.response || input;\n  \n  // If response is a string, parse it as JSON\n  if (typeof response === 'string') {\n    storyData = JSON.parse(response);\n  } else {\n    storyData = response;\n  }\n} catch (error) {\n  // If parsing fails, return an error state\n  return [{\n    json: {\n      error: true,\n      message: 'Failed to parse API response',\n      rawResponse: input.response\n    }\n  }];\n}\n\n// Extract story elements from the parsed response\nconst currentSituation = storyData.currentSituation || storyData.situation || '';\nconst options = storyData.options || [];\nconst timeJump = storyData.timeJump || '';\nconst newTimePeriod = storyData.newTimePeriod || storyData.timePeriod || input.timePeriod || 'Âá∫Áîü';\nconst newAge = storyData.newAge || storyData.age || input.currentAge || 'Â©¥ÂÑø';\nconst isGameEnding = storyData.isGameEnding || storyData.gameEnding || false;\nconst npcPersonalities = storyData.npcPersonalities || [];\n\n// Extract game state fields from input (coming from Call DeepSeek API node)\nconst gameState = {\n  sessionId: input.sessionId,\n  playerName: input.playerName,\n  choiceHistory: input.choiceHistory || [],\n  storyProgress: input.storyProgress || 0,\n  gameEnded: input.gameEnded || false,\n  currentAge: input.currentAge || 'Â©¥ÂÑø',\n  timePeriod: input.timePeriod || 'Âá∫Áîü',\n  gender: input.gender || '',\n  background: input.background || ''\n};\n\n// Return combined object with all fields needed for the form\nreturn [{\n  json: {\n    ...gameState,\n    currentSituation: currentSituation,\n    options: options,\n    timeJump: timeJump,\n    newTimePeriod: newTimePeriod,\n    newAge: newAge,\n    isGameEnding: isGameEnding,\n    npcPersonalities: npcPersonalities\n  }\n}];"
      },
      "id": "6049e03d-d6b5-41de-ad19-24262bc45ec7",
      "name": "Parse Story Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1168,
        -112
      ]
    },
    {
      "parameters": {
        "defineForm": "json",
        "jsonOutput": "=[\n  {\n    \"fieldLabel\": \"‰Ω†ÁöÑÈÄâÊã©\",\n    \"fieldType\": \"dropdown\",\n    \"fieldOptions\": {\n      \"values\": {{ $json.options.map(opt => ({ option: opt.text })) }}\n    },\n    \"requiredField\": true\n  }\n]",
        "options": {
          "formTitle": "={{ $json.timeJump + ' - ' + $json.newTimePeriod }}",
          "formDescription": "={{ $json.currentSituation }}",
          "buttonLabel": "Á°ÆËÆ§ÈÄâÊã©"
        }
      },
      "id": "a8437067-03f3-4782-9259-ba358cbde401",
      "name": "Story Choice Form",
      "type": "n8n-nodes-base.form",
      "typeVersion": 2.3,
      "position": [
        1392,
        -112
      ],
      "webhookId": "47943eb2-0576-407e-9b85-cdfc213b8661"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "id-1",
              "name": "choiceHistory",
              "value": "={{ $('Parse Story Response').first().json.choiceHistory.concat([{ situation: $('Parse Story Response').first().json.currentSituation, chosen: $json['‰Ω†ÁöÑÈÄâÊã©'], timestamp: $now.toISO() }]) }}",
              "type": "array"
            },
            {
              "id": "id-2",
              "name": "storyProgress",
              "value": "={{ ($('Parse Story Response').first().json.storyProgress ?? 0) + 1 }}",
              "type": "number"
            },
            {
              "id": "id-3",
              "name": "currentAge",
              "value": "={{ $('Parse Story Response').first().json.newAge }}",
              "type": "string"
            },
            {
              "id": "id-4",
              "name": "timePeriod",
              "value": "={{ $('Parse Story Response').first().json.newTimePeriod }}",
              "type": "string"
            },
            {
              "id": "id-5",
              "name": "gameEnded",
              "value": "={{ $('Parse Story Response').first().json.isGameEnding }}",
              "type": "boolean"
            },
            {
              "id": "id-6",
              "name": "sessionId",
              "value": "={{ $('Parse Story Response').first().json.sessionId }}",
              "type": "string"
            },
            {
              "id": "id-7",
              "name": "playerName",
              "value": "={{ $('Parse Story Response').first().json.playerName }}",
              "type": "string"
            },
            {
              "id": "id-8",
              "name": "gender",
              "value": "={{ $('Parse Story Response').first().json.gender }}",
              "type": "string"
            },
            {
              "id": "id-9",
              "name": "background",
              "value": "={{ $('Parse Story Response').first().json.background }}",
              "type": "string"
            },
            {
              "id": "id-10",
              "name": "npcPersonalities",
              "value": "={{ JSON.stringify($('Parse Story Response').first().json.npcPersonalities) }}",
              "type": "string"
            }
          ]
        },
        "includeOtherFields": true,
        "options": {}
      },
      "id": "03506a47-bb85-4bb9-8db7-0a5337f2b147",
      "name": "Update Game State",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1616,
        -112
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "id-1",
              "leftValue": "={{ Boolean($json.gameEnded) }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "id": "cf45db29-7227-4abe-8ef4-9b15a1a7d0ed",
      "name": "Check Game End",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2064,
        -32
      ]
    },
    {
      "parameters": {
        "jsCode": "// Generate achievements based on actual story events from choiceHistory\nconst gameState = $input.first().json;\n\n// Parse choiceHistory if it's a string\nlet choiceHistory = gameState.choiceHistory || [];\nif (typeof choiceHistory === 'string') {\n  try {\n    choiceHistory = JSON.parse(choiceHistory);\n  } catch (error) {\n    choiceHistory = [];\n  }\n}\n\nconst totalChoices = choiceHistory.length;\n\n// Analyze story patterns from choice history\nconst storyAnalysis = {\n  savedCharacters: 0,\n  eliminatedRivals: 0,\n  alliances: 0,\n  betrayals: 0,\n  romanticChoices: 0,\n  powerMoves: 0,\n  survivalSituations: 0,\n  kindActions: 0,\n  ruthlessActions: 0,\n  diplomaticActions: 0,\n  aggressiveActions: 0\n};\n\n// Keywords for pattern detection\nconst patterns = {\n  save: ['Êïë', 'Â∏ÆÂä©', '‰øùÊä§', 'Êè¥Âä©', 'Êê≠Êïë', 'Ëß£Êïë'],\n  eliminate: ['Èô§Êéâ', 'ÊùÄ', 'ÊØí', 'Èô∑ÂÆ≥', 'Èì≤Èô§', 'ÊöóÊùÄ', 'Â§ÑÂÜ≥'],\n  alliance: ['ËÅîÁõü', 'ÁªìÁõü', 'Âêà‰Ωú', 'ËÅîÊâã', 'ÊãâÊã¢', 'Áªì‰∫§'],\n  betrayal: ['ËÉåÂèõ', 'Âá∫Âçñ', 'ÂèçÊ∞¥', 'ÂëäÂØÜ', 'Èô∑ÂÆ≥'],\n  romance: ['Áà±', 'ÊÉÖ', 'ÊÅã', 'ÂñúÊ¨¢', 'ÂÄæÂøÉ', 'ÈíüÊÉÖ', 'ÁßÅ‰ºö'],\n  power: ['ÊùÉ', 'Âäø', 'ÊéåÊéß', 'ÊéßÂà∂', 'Â§∫ÊùÉ', 'ÁØ°‰Ωç', 'ÁôªÂü∫'],\n  survival: ['ÈÄÉ', 'Ë∫≤', 'ÈÅø', 'ÈöêÂøç', 'ÂøçËÄê', 'Ê±ÇÁîü'],\n  kind: ['‰ªÅÊÖà', 'ÂÆΩÊÅï', 'ÂñÑËâØ', 'ÊÖàÊÇ≤', 'ÊÄúÊÇØ', 'Ê∏©Êüî'],\n  ruthless: ['ÂÜ∑ÈÖ∑', 'Êó†ÊÉÖ', 'Áã†Ëæ£', 'ÊÆãÂøç', 'ÊûúÊñ≠'],\n  diplomatic: ['Â§ñ‰∫§', 'Ë∞àÂà§', 'Êñ°Êóã', 'Ë∞ÉËß£', 'ÂíåËß£', 'Â¶•Âçè'],\n  aggressive: ['ËøõÊîª', 'Âº∫Á°¨', 'ÊøÄËøõ', '‰∏ªÂä®Âá∫Âáª', 'ÂÖàÂèëÂà∂‰∫∫']\n};\n\n// Analyze each choice\nchoiceHistory.forEach(choice => {\n  const situation = (choice.situation || '').toLowerCase();\n  const chosen = (choice.chosen || '').toLowerCase();\n  const combined = situation + ' ' + chosen;\n  \n  // Check for patterns\n  if (patterns.save.some(keyword => combined.includes(keyword))) storyAnalysis.savedCharacters++;\n  if (patterns.eliminate.some(keyword => combined.includes(keyword))) storyAnalysis.eliminatedRivals++;\n  if (patterns.alliance.some(keyword => combined.includes(keyword))) storyAnalysis.alliances++;\n  if (patterns.betrayal.some(keyword => combined.includes(keyword))) storyAnalysis.betrayals++;\n  if (patterns.romance.some(keyword => combined.includes(keyword))) storyAnalysis.romanticChoices++;\n  if (patterns.power.some(keyword => combined.includes(keyword))) storyAnalysis.powerMoves++;\n  if (patterns.survival.some(keyword => combined.includes(keyword))) storyAnalysis.survivalSituations++;\n  if (patterns.kind.some(keyword => combined.includes(keyword))) storyAnalysis.kindActions++;\n  if (patterns.ruthless.some(keyword => combined.includes(keyword))) storyAnalysis.ruthlessActions++;\n  if (patterns.diplomatic.some(keyword => combined.includes(keyword))) storyAnalysis.diplomaticActions++;\n  if (patterns.aggressive.some(keyword => combined.includes(keyword))) storyAnalysis.aggressiveActions++;\n});\n\n// Define story-based achievements\nconst allAchievements = [\n  {\n    id: 'savior',\n    title: 'ÊïëÂëΩÊÅ©‰∫∫',\n    description: 'Âú®Âç±ÊÄ•Êó∂ÂàªÊãØÊïë‰∫Ü‰ªñ‰∫∫ÁöÑÊÄßÂëΩ',\n    icon: 'üôè',\n    condition: () => storyAnalysis.savedCharacters >= 2\n  },\n  {\n    id: 'ruthless',\n    title: 'ÂÜ∑Ë°ÄÊó†ÊÉÖ',\n    description: 'ÊØ´‰∏çÁïôÊÉÖÂú∞Èì≤Èô§‰∫ÜÂ§ö‰∏™ÂØπÊâã',\n    icon: '‚ùÑÔ∏è',\n    condition: () => storyAnalysis.eliminatedRivals >= 3\n  },\n  {\n    id: 'strategist',\n    title: 'ÊùÉË∞ãÈ´òÊâã',\n    description: 'Âª∫Á´ã‰∫ÜÂ§ö‰∏™ÊàòÁï•ËÅîÁõü',\n    icon: 'üéØ',\n    condition: () => storyAnalysis.alliances >= 2\n  },\n  {\n    id: 'romantic',\n    title: 'Áà±ÊÅ®ÊÉÖ‰ªá',\n    description: 'Âú®ÂÆ´Âª∑‰∏≠ÁªèÂéÜ‰∫ÜÂàªÈ™®Èì≠ÂøÉÁöÑÊÉÖÊÑüÁ∫†Ëëõ',\n    icon: 'üíï',\n    condition: () => storyAnalysis.romanticChoices >= 2\n  },\n  {\n    id: 'betrayer',\n    title: 'ËÉå‰ø°ÂºÉ‰πâ',\n    description: '‰∏∫‰∫ÜÊùÉÂäõ‰∏çÊÉúËÉåÂèõÁõüÂèã',\n    icon: 'üó°Ô∏è',\n    condition: () => storyAnalysis.betrayals >= 2\n  },\n  {\n    id: 'power_hungry',\n    title: 'ÊùÉÂäõËá≥‰∏ä',\n    description: 'ÂßãÁªàÂ∞ÜÊùÉÂäõÊîæÂú®È¶ñ‰Ωç',\n    icon: 'üëë',\n    condition: () => storyAnalysis.powerMoves >= 3\n  },\n  {\n    id: 'survivor',\n    title: 'ÁîüÂ≠òÂ§ßÂ∏à',\n    description: 'Âú®Âç±Êú∫Âõõ‰ºèÁöÑÂÆ´Âª∑‰∏≠Â∑ßÂ¶ôÁîüÂ≠ò',\n    icon: 'üõ°Ô∏è',\n    condition: () => storyAnalysis.survivalSituations >= 3\n  },\n  {\n    id: 'benevolent',\n    title: '‰ªÅÊÖà‰πãÂøÉ',\n    description: 'Âú®ÊÆãÈÖ∑ÁöÑÂÆ´Âª∑‰∏≠‰øùÊåÅÂñÑËâØ',\n    icon: '‚ú®',\n    condition: () => storyAnalysis.kindActions >= 3\n  },\n  {\n    id: 'iron_fist',\n    title: 'ÈìÅËÖïÁªüÊ≤ª',\n    description: '‰ª•Âº∫Á°¨ÊâãÊÆµÊéåÊéßÂ±ÄÂäø',\n    icon: '‚öîÔ∏è',\n    condition: () => storyAnalysis.ruthlessActions >= 3\n  },\n  {\n    id: 'diplomat',\n    title: 'Â§ñ‰∫§Â§ßÂ∏à',\n    description: 'ÂñÑ‰∫éÈÄöËøáË∞àÂà§ÂåñËß£Âç±Êú∫',\n    icon: 'üïäÔ∏è',\n    condition: () => storyAnalysis.diplomaticActions >= 2\n  },\n  {\n    id: 'first_step',\n    title: 'ÂàùÂÖ•ÂÆ´Âª∑',\n    description: 'Ë∏èÂÖ•ÂÆ´Âª∑ÁöÑÁ¨¨‰∏ÄÊ≠•',\n    icon: 'üé≠',\n    condition: () => totalChoices >= 1\n  },\n  {\n    id: 'veteran',\n    title: 'ÂÆ´Âª∑ËÄÅÊâã',\n    description: 'Âú®ÂÆ´Âª∑‰∏≠ÁªèÂéÜ‰∫ÜÂÆåÊï¥ÁöÑ‰∫∫Áîü',\n    icon: 'üèõÔ∏è',\n    condition: () => totalChoices >= 12\n  }\n];\n\n// Check which achievements were earned\nconst earnedAchievements = allAchievements.filter(achievement => \n  achievement.condition()\n);\n\n// Determine ending type based on story analysis and final state\nlet endingType = 'ÊôÆÈÄöÁªìÂ±Ä';\nconst lastChoice = choiceHistory[choiceHistory.length - 1] || {};\nconst finalSituation = ((lastChoice.situation || '') + ' ' + (lastChoice.chosen || '')).toLowerCase();\n\n// Check for specific ending patterns\nif (finalSituation.includes('ÁöáÂ∏ù') || finalSituation.includes('ÁôªÂü∫') || finalSituation.includes('Áß∞Â∏ù')) {\n  endingType = 'üëë ‰πù‰∫î‰πãÂ∞ä - ÁôªÂü∫‰∏∫Â∏ù';\n} else if (finalSituation.includes('ÁöáÂêé') || finalSituation.includes('Âêé‰Ωç')) {\n  endingType = 'üë∏ ÊØç‰ª™Â§©‰∏ã - Êàê‰∏∫ÁöáÂêé';\n} else if (finalSituation.includes('ÊëÑÊîø') || finalSituation.includes('ÊéåÊùÉ')) {\n  endingType = '‚öúÔ∏è ÊùÉÂÄæÊúùÈáé - ÊëÑÊîøÊéåÊùÉ';\n} else if (finalSituation.includes('Ê≠ª') || finalSituation.includes('‰∫°') || finalSituation.includes('ÊØí')) {\n  endingType = 'üíÄ È¶ôÊ∂àÁéâÊÆí - ÂëΩ‰∏ßÂÆ´Âª∑';\n} else if (finalSituation.includes('ÈÄÉ') || finalSituation.includes('Á¶ªÂºÄ') || finalSituation.includes('ÁßÅÂ•î')) {\n  endingType = 'üåÖ ËøúËµ∞È´òÈ£û - ÈÄÉÁ¶ªÂÆ´Âª∑';\n} else if (storyAnalysis.powerMoves >= 4) {\n  endingType = 'üéØ ÊùÉË∞ãÂ§ßÂ∏à - ÊéåÊéßÂ±ÄÂäø';\n} else if (storyAnalysis.eliminatedRivals >= 4) {\n  endingType = '‚öîÔ∏è ÈìÅË°ÄÊâãËÖï - Èì≤Èô§ÂºÇÂ∑±';\n} else if (storyAnalysis.alliances >= 3) {\n  endingType = 'ü§ù Á∫µÊ®™Êç≠Èòñ - ËÅîÁõüÂà∂ËÉú';\n} else if (storyAnalysis.romanticChoices >= 3) {\n  endingType = 'üíï ÊÉÖÂÆö‰∏âÁîü - Áà±ÊÉÖËá≥‰∏ä';\n} else if (storyAnalysis.kindActions >= 4) {\n  endingType = '‚ú® ‰ªÅÂæ∑‰πãÂêç - ‰ª•Âæ∑Êúç‰∫∫';\n} else if (totalChoices >= 10) {\n  endingType = 'üèõÔ∏è ÂÆ´Âª∑‰º†Â•á - ÁïôÂêçÈùíÂè≤';\n} else if (totalChoices >= 5) {\n  endingType = 'üå∏ ÂÆâÁÑ∂Â∫¶Êó• - Âπ≥Á®≥ÁîüÂ≠ò';\n} else {\n  endingType = '‚≠ê ÂàùÁ™•Èó®ÂæÑ - ÂàùÂÖ•ÂÆ´Âª∑';\n}\n\n// Return the result\nreturn {\n  json: {\n    endingType: endingType,\n    totalChoices: totalChoices,\n    achievements: earnedAchievements,\n    playerName: gameState.playerName || 'Áé©ÂÆ∂',\n    finalAge: gameState.currentAge || 'Êú™Áü•',\n    finalPeriod: gameState.timePeriod || 'Êú™Áü•',\n    storyAnalysis: storyAnalysis\n  }\n};"
      },
      "id": "bb2431e6-c926-4b8d-b1bd-3cec26ab7a0e",
      "name": "Generate Achievements",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2288,
        -32
      ]
    },
    {
      "parameters": {
        "formFields": {
          "values": [
            {
              "fieldType": "html",
              "html": "={{ '# Ê∏∏ÊàèÁªìÊùü\\n\\n## ' + $json.endingType + '\\n\\n‰Ω†Âú®Ëøô‰∏ÄÂë®ÁõÆ‰∏≠ÂÅöÂá∫‰∫Ü **' + $json.totalChoices + '** ‰∏™ÈÄâÊã©„ÄÇ\\n\\n### üèÜ Ëé∑ÂæóÊàêÂ∞±\\n\\n' + $json.achievements.map(a => a.icon + ' **' + a.title + '**: ' + a.description).join('\\n\\n') + '\\n\\n---' }}"
            }
          ]
        },
        "options": {
          "formTitle": "Ê∏∏ÊàèÁªìÊùü",
          "formDescription": "",
          "buttonLabel": "ÂºÄÂßãÊñ∞ÁöÑ‰∏ÄÂë®ÁõÆ"
        }
      },
      "id": "b35af646-4407-4c16-8961-168b99830176",
      "name": "Game End Screen",
      "type": "n8n-nodes-base.form",
      "typeVersion": 2.3,
      "position": [
        2512,
        -32
      ],
      "webhookId": "0c17f7d5-512f-40c1-a57a-6b1cf8e1e9d3"
    },
    {
      "parameters": {
        "operation": "update",
        "dataTableId": {
          "__rl": true,
          "value": "AKf25SheQQH4ASxQ",
          "mode": "list",
          "cachedResultName": "palace_game_sessions",
          "cachedResultUrl": "/projects/znm1hvFsbhET4byn/datatables/AKf25SheQQH4ASxQ"
        },
        "filters": {
          "conditions": [
            {
              "keyName": "sessionId",
              "keyValue": "={{ $json.sessionId }}"
            }
          ]
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "sessionId": "={{ $json.sessionId }}",
            "playerName": "={{ $json.playerName }}",
            "choiceHistory": "={{ JSON.stringify($json.choiceHistory) }}",
            "storyProgress": "={{ $json.storyProgress }}",
            "gameEnded": "={{ $json.gameEnded }}",
            "currentAge": "={{ $json.currentAge }}",
            "timePeriod": "={{ $json.timePeriod }}",
            "gender": "={{ $json.gender }}",
            "background": "={{ $json.background }}",
            "npcPersonalities": "={{ JSON.stringify($json.npcPersonalities) }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "sessionId",
              "displayName": "sessionId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "playerName",
              "displayName": "playerName",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "choiceHistory",
              "displayName": "choiceHistory",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "storyProgress",
              "displayName": "storyProgress",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "gameEnded",
              "displayName": "gameEnded",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "boolean",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "currentAge",
              "displayName": "currentAge",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "timePeriod",
              "displayName": "timePeriod",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "gender",
              "displayName": "gender",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "background",
              "displayName": "background",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            },
            {
              "id": "npcPersonalities",
              "displayName": "npcPersonalities",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "readOnly": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "1765bd02-62e2-4e99-a6cf-a621aaf4b961",
      "name": "Update Game State in DB",
      "type": "n8n-nodes-base.dataTable",
      "typeVersion": 1,
      "position": [
        1840,
        -112
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.deepseek.com/v1/chat/completions",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer [ËØ∑Âú®Ê≠§Â§ÑÊ∑ªÂä†ÊÇ®ÁöÑDeepSeek APIÂØÜÈí•]"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"deepseek-chat\",\n  \"messages\": [\n    {\n      \"role\": \"system\",\n      \"content\": {{ JSON.stringify($json.systemInstructions) }}\n    },\n    {\n      \"role\": \"user\",\n      \"content\": {{ JSON.stringify($json.userPrompt) }}\n    }\n  ],\n  \"temperature\": 0.8,\n  \"response_format\": {\n    \"type\": \"json_object\"\n  }\n}",
        "options": {}
      },
      "id": "a03ed307-a7b6-481b-a0c8-8865eb75002e",
      "name": "Call DeepSeek API",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        720,
        -112
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "ke8oqk5KnDEoymFw",
          "name": "Header Auth account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Merge API Response with Game State\nconst apiResponse = $input.first().json;\nconst gameStateNode = $('Generate Story Prompt').first().json;\n\n// Extract the content from the API response\nlet storyData;\ntry {\n  // Get the content from choices[0].message.content\n  const content = apiResponse.choices[0].message.content;\n  \n  // Parse the content as JSON\n  storyData = JSON.parse(content);\n} catch (error) {\n  // If parsing fails, return an error state\n  return [{\n    json: {\n      error: true,\n      message: 'Failed to parse API response',\n      rawResponse: apiResponse\n    }\n  }];\n}\n\n// Parse npcPersonalities from gameStateNode if it's a string\nlet npcPersonalities = gameStateNode.npcPersonalities || [];\nif (typeof npcPersonalities === 'string') {\n  try {\n    npcPersonalities = JSON.parse(npcPersonalities);\n  } catch (error) {\n    npcPersonalities = [];\n  }\n}\n\n// Extract game state fields from Generate Story Prompt node\nconst gameState = {\n  sessionId: gameStateNode.sessionId,\n  playerName: gameStateNode.playerName,\n  choiceHistory: gameStateNode.choiceHistory || [],\n  storyProgress: gameStateNode.storyProgress || 0,\n  currentAge: gameStateNode.currentAge || 'Â©¥ÂÑø',\n  timePeriod: gameStateNode.timePeriod || 'Âá∫Áîü',\n  gameEnded: gameStateNode.gameEnded || false,\n  gender: gameStateNode.gender || '',\n  background: gameStateNode.background || '',\n  npcPersonalities: npcPersonalities\n};\n\n// Extract story elements from the parsed response\nconst currentSituation = storyData.currentSituation || '';\nconst options = storyData.options || [];\nconst timeJump = storyData.timeJump || '';\nconst newTimePeriod = storyData.newTimePeriod || gameState.timePeriod;\nconst newAge = storyData.newAge || gameState.currentAge;\nconst isGameEnding = storyData.isGameEnding || false;\nconst npcPersonalitiesFromResponse = storyData.npcPersonalities || gameState.npcPersonalities;\n\n// Return merged object with all fields\nreturn [{\n  json: {\n    ...gameState,\n    currentSituation: currentSituation,\n    options: options,\n    timeJump: timeJump,\n    newTimePeriod: newTimePeriod,\n    newAge: newAge,\n    isGameEnding: isGameEnding,\n    npcPersonalities: npcPersonalitiesFromResponse\n  }\n}];"
      },
      "id": "990ba9b6-81f1-46e2-a06e-f5ad7c40ad52",
      "name": "Merge API Response with Game State",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        944,
        -112
      ]
    }
  ],
  "pinData": {},
  "connections": {
    "Game Start": {
      "main": [
        [
          {
            "node": "Initialize Game State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Initialize Game State": {
      "main": [
        [
          {
            "node": "Save Game State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save Game State": {
      "main": [
        [
          {
            "node": "Load Game State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Load Game State": {
      "main": [
        [
          {
            "node": "Prepare Story Context",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Story Context": {
      "main": [
        [
          {
            "node": "Generate Story Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Story Prompt": {
      "main": [
        [
          {
            "node": "Call DeepSeek API",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse Story Response": {
      "main": [
        [
          {
            "node": "Story Choice Form",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Story Choice Form": {
      "main": [
        [
          {
            "node": "Update Game State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Game State": {
      "main": [
        [
          {
            "node": "Update Game State in DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Game End": {
      "main": [
        [
          {
            "node": "Generate Achievements",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Load Game State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Achievements": {
      "main": [
        [
          {
            "node": "Game End Screen",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Update Game State in DB": {
      "main": [
        [
          {
            "node": "Check Game End",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call DeepSeek API": {
      "main": [
        [
          {
            "node": "Merge API Response with Game State",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Merge API Response with Game State": {
      "main": [
        [
          {
            "node": "Parse Story Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "3503c036-7001-4a98-8014-15fe902adada",
  "meta": {
    "instanceId": "ebdd3b25c25df48b88a8258324b71b76e5fceb27a41e4284c4a673cf6fbeed02"
  },
  "id": "3ZMaHQaXDn3FWrNc",
  "tags": []
}
